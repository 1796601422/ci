import React, { useEffect, useRef, useState, useCallback } from 'react';
import './SpaceVisualization3D.css';

interface SpaceVisualization3DProps {
  centerWord: string;
  selectedWords: string[];
}

interface WordPosition {
  word: string;
  x: number;
  y: number;
  z: number;
  similarity: number;
  isRelated: boolean;
}

const SpaceVisualization3D: React.FC<SpaceVisualization3DProps> = ({
  centerWord,
  selectedWords
}) => {
  const canvasRef = useRef<HTMLCanvasElement>(null);
  const [rotation, setRotation] = useState({ x: 0, y: 0 });
  const [isDragging, setIsDragging] = useState(false);
  const [lastMouse, setLastMouse] = useState({ x: 0, y: 0 });
  const [zoom, setZoom] = useState(1);
  const [hoveredWord, setHoveredWord] = useState<string | null>(null);
  const [animationTime, setAnimationTime] = useState(0);
  const [wordsAppearProgress, setWordsAppearProgress] = useState(0);
  const [autoRotate, setAutoRotate] = useState(true);
  const [stars, setStars] = useState<Array<{x: number, y: number, size: number, opacity: number, twinkleSpeed: number}>>([]);
  const animationFrameRef = useRef<number>();

  // é¢„å®šä¹‰çš„è¯è¯­ç›¸ä¼¼æ€§å…³ç³»
  const similarityData: Record<string, Record<string, number>> = {
    'å›½ç‹': {
      // ç›¸å…³è¯è¯­ (é«˜ç›¸ä¼¼æ€§)
      'ç‹å': 0.9, 'åŸå ¡': 0.8, 'çš‡å† ': 0.85, 'æƒåŠ›': 0.75, 'ç»Ÿæ²»': 0.7, 'è´µæ—': 0.65, 'ç‹å­': 0.8, 'å…¬ä¸»': 0.8,
      'ç‹å›½': 0.85, 'å›ä¸»': 0.9, 'å®åº§': 0.75, 'ç‹å®¤': 0.8, 'éª‘å£«': 0.7, 'å¤§è‡£': 0.6, 'å®«æ®¿': 0.75, 'å¸ç‹': 0.85, 'çš‡å®¤': 0.8, 'è‡£æ°‘': 0.6,
      // æ— å…³è¯è¯­ (ä½ç›¸ä¼¼æ€§)
      'çŸ³å¤´': 0.1, 'æ¤…å­': 0.15, 'æ•°å­—': 0.05, 'é¢œè‰²': 0.1, 'å£°éŸ³': 0.05, 'æ—¶é—´': 0.2, 'ç©ºé—´': 0.15, 'æ–¹å‘': 0.1,
      'æœºå™¨': 0.05, 'ç”µè„‘': 0.1, 'æ°´æœ': 0.05, 'å¤©æ°”': 0.1, 'æœˆäº®': 0.15, 'æ˜Ÿæ˜Ÿ': 0.1, 'æ±½è½¦': 0.05, 'é£æœº': 0.05, 'æ ‘æœ¨': 0.1, 'èŠ±æœµ': 0.2, 'å»ºç­‘': 0.3, 'é‡‘å±': 0.05
    },
    'åŒ»ç”Ÿ': {
      // ç›¸å…³è¯è¯­ (é«˜ç›¸ä¼¼æ€§)
      'æŠ¤å£«': 0.85, 'åŒ»é™¢': 0.9, 'ç—…äºº': 0.8, 'æ‰‹æœ¯': 0.75, 'è¯ç‰©': 0.7, 'æ²»ç–—': 0.8, 'å¥åº·': 0.85, 'è¯Šæ–­': 0.7,
      'åŒ»ç–—': 0.9, 'æ•‘æŠ¤': 0.8, 'ç—…æˆ¿': 0.85, 'åŒ»å¸ˆ': 0.95, 'ä¸´åºŠ': 0.75, 'å¤„æ–¹': 0.7, 'åº·å¤': 0.75, 'åŒ»å­¦': 0.85, 'ç–—æ³•': 0.8, 'æ£€æŸ¥': 0.75,
      // æ— å…³è¯è¯­ (ä½ç›¸ä¼¼æ€§)
      'çŸ³å¤´': 0.05, 'æ¤…å­': 0.1, 'æ•°å­—': 0.15, 'é¢œè‰²': 0.05, 'å£°éŸ³': 0.1, 'æ—¶é—´': 0.2, 'ç©ºé—´': 0.1, 'æ–¹å‘': 0.05,
      'æœºå™¨': 0.2, 'ç”µè„‘': 0.25, 'æ°´æœ': 0.1, 'å¤©æ°”': 0.05, 'æœˆäº®': 0.05, 'æ˜Ÿæ˜Ÿ': 0.05, 'æ±½è½¦': 0.1, 'é£æœº': 0.05, 'æ ‘æœ¨': 0.05, 'èŠ±æœµ': 0.05, 'å»ºç­‘': 0.15, 'é‡‘å±': 0.1
    },
    'å­¦æ ¡': {
      // ç›¸å…³è¯è¯­ (é«˜ç›¸ä¼¼æ€§)
      'è€å¸ˆ': 0.9, 'å­¦ç”Ÿ': 0.9, 'æ•™å®¤': 0.85, 'ä¹¦æœ¬': 0.8, 'è€ƒè¯•': 0.75, 'å­¦ä¹ ': 0.85, 'çŸ¥è¯†': 0.8, 'è¯¾ç¨‹': 0.8,
      'æ ¡å›­': 0.9, 'æ•™è‚²': 0.9, 'ä½œä¸š': 0.8, 'åŒå­¦': 0.85, 'è®²å°': 0.75, 'é»‘æ¿': 0.7, 'ç¬”è®°': 0.7, 'æ¯•ä¸š': 0.8, 'ä¸Šè¯¾': 0.85, 'æ•™å­¦': 0.85,
      // æ— å…³è¯è¯­ (ä½ç›¸ä¼¼æ€§)
      'çŸ³å¤´': 0.05, 'æ¤…å­': 0.2, 'æ•°å­—': 0.25, 'é¢œè‰²': 0.1, 'å£°éŸ³': 0.15, 'æ—¶é—´': 0.3, 'ç©ºé—´': 0.2, 'æ–¹å‘': 0.1,
      'æœºå™¨': 0.1, 'ç”µè„‘': 0.4, 'æ°´æœ': 0.05, 'å¤©æ°”': 0.05, 'æœˆäº®': 0.05, 'æ˜Ÿæ˜Ÿ': 0.05, 'æ±½è½¦': 0.1, 'é£æœº': 0.05, 'æ ‘æœ¨': 0.1, 'èŠ±æœµ': 0.1, 'å»ºç­‘': 0.5, 'é‡‘å±': 0.1
    },
    'å¿«ä¹': {
      // ç›¸å…³è¯è¯­ (é«˜ç›¸ä¼¼æ€§)
      'å¼€å¿ƒ': 0.95, 'ç¬‘å®¹': 0.85, 'å–œæ‚¦': 0.9, 'å¹¸ç¦': 0.9, 'æ„‰å¿«': 0.85, 'é«˜å…´': 0.9, 'æ¬¢ä¹': 0.85, 'æ»¡è¶³': 0.8,
      'å¿«æ´»': 0.9, 'å…´å¥‹': 0.85, 'æ„‰æ‚¦': 0.9, 'æ¬¢å–œ': 0.85, 'ä¹è¶£': 0.8, 'ç”œèœœ': 0.75, 'èˆ’å¿ƒ': 0.8, 'ç•…å¿«': 0.85, 'æ¬£å–œ': 0.9, 'é™¶é†‰': 0.75,
      // æ— å…³è¯è¯­ (ä½ç›¸ä¼¼æ€§)
      'çŸ³å¤´': 0.05, 'æ¤…å­': 0.05, 'æ•°å­—': 0.05, 'é¢œè‰²': 0.2, 'å£°éŸ³': 0.3, 'æ—¶é—´': 0.1, 'ç©ºé—´': 0.05, 'æ–¹å‘': 0.05,
      'æœºå™¨': 0.05, 'ç”µè„‘': 0.05, 'æ°´æœ': 0.2, 'å¤©æ°”': 0.3, 'æœˆäº®': 0.2, 'æ˜Ÿæ˜Ÿ': 0.25, 'æ±½è½¦': 0.1, 'é£æœº': 0.15, 'æ ‘æœ¨': 0.25, 'èŠ±æœµ': 0.4, 'å»ºç­‘': 0.1, 'é‡‘å±': 0.05
    },
    'ç¾ä¸½': {
      // ç›¸å…³è¯è¯­ (é«˜ç›¸ä¼¼æ€§)
      'æ¼‚äº®': 0.95, 'ä¼˜é›…': 0.85, 'è¿·äºº': 0.9, 'åŠ¨äºº': 0.85, 'ç§€ä¸½': 0.9, 'åä¸½': 0.8, 'ç²¾ç¾': 0.85, 'ç»šä¸½': 0.85,
      'ä¿Šç¾': 0.9, 'å…¸é›…': 0.85, 'å¨‡ç¾': 0.9, 'ç«¯åº„': 0.8, 'æ¸…ç§€': 0.85, 'é“ä¸½': 0.9, 'é£é›…': 0.8, 'ç§€ç¾': 0.9, 'å¦©åªš': 0.85, 'å¨‡è‰³': 0.85,
      // æ— å…³è¯è¯­ (ä½ç›¸ä¼¼æ€§)
      'çŸ³å¤´': 0.1, 'æ¤…å­': 0.1, 'æ•°å­—': 0.05, 'é¢œè‰²': 0.6, 'å£°éŸ³': 0.2, 'æ—¶é—´': 0.1, 'ç©ºé—´': 0.15, 'æ–¹å‘': 0.05,
      'æœºå™¨': 0.05, 'ç”µè„‘': 0.05, 'æ°´æœ': 0.3, 'å¤©æ°”': 0.4, 'æœˆäº®': 0.6, 'æ˜Ÿæ˜Ÿ': 0.7, 'æ±½è½¦': 0.2, 'é£æœº': 0.15, 'æ ‘æœ¨': 0.5, 'èŠ±æœµ': 0.8, 'å»ºç­‘': 0.4, 'é‡‘å±': 0.1
    },
    'è·‘æ­¥': {
      // ç›¸å…³è¯è¯­ (é«˜ç›¸ä¼¼æ€§)
      'å¥”è·‘': 0.95, 'è¿åŠ¨': 0.9, 'å¥èº«': 0.85, 'é”»ç‚¼': 0.85, 'é€Ÿåº¦': 0.8, 'ä½“è‚²': 0.85, 'ç«èµ›': 0.8, 'é©¬æ‹‰æ¾': 0.9,
      'æ…¢è·‘': 0.9, 'å†²åˆº': 0.85, 'èµ›è·‘': 0.9, 'ç”°å¾„': 0.85, 'è®­ç»ƒ': 0.8, 'å¥åº·': 0.7, 'è€åŠ›': 0.8, 'è·¨æ­¥': 0.8, 'ç–¾è·‘': 0.9, 'é•¿è·‘': 0.9,
      // æ— å…³è¯è¯­ (ä½ç›¸ä¼¼æ€§)
      'çŸ³å¤´': 0.05, 'æ¤…å­': 0.1, 'æ•°å­—': 0.15, 'é¢œè‰²': 0.05, 'å£°éŸ³': 0.15, 'æ—¶é—´': 0.3, 'ç©ºé—´': 0.4, 'æ–¹å‘': 0.6,
      'æœºå™¨': 0.1, 'ç”µè„‘': 0.05, 'æ°´æœ': 0.1, 'å¤©æ°”': 0.2, 'æœˆäº®': 0.05, 'æ˜Ÿæ˜Ÿ': 0.05, 'æ±½è½¦': 0.3, 'é£æœº': 0.2, 'æ ‘æœ¨': 0.2, 'èŠ±æœµ': 0.1, 'å»ºç­‘': 0.1, 'é‡‘å±': 0.05
    },
    'éŸ³ä¹': {
      // ç›¸å…³è¯è¯­ (é«˜ç›¸ä¼¼æ€§)
      'æ­Œæ›²': 0.95, 'ä¹å™¨': 0.9, 'æ—‹å¾‹': 0.9, 'èŠ‚æ‹': 0.85, 'æ¼”å¥': 0.9, 'æ­Œå£°': 0.9, 'ä½œæ›²': 0.85, 'éŸ³ç¬¦': 0.85,
      'å’Œå£°': 0.8, 'ä¹é˜Ÿ': 0.85, 'æ­Œæ‰‹': 0.85, 'é’¢ç´': 0.8, 'å‰ä»–': 0.8, 'å°æç´': 0.8, 'åˆå”±': 0.85, 'éŸ³å“': 0.75, 'å½•éŸ³': 0.75, 'æ¼”å”±': 0.9,
      // æ— å…³è¯è¯­ (ä½ç›¸ä¼¼æ€§)
      'çŸ³å¤´': 0.05, 'æ¤…å­': 0.1, 'æ•°å­—': 0.1, 'é¢œè‰²': 0.2, 'å£°éŸ³': 0.6, 'æ—¶é—´': 0.3, 'ç©ºé—´': 0.2, 'æ–¹å‘': 0.05,
      'æœºå™¨': 0.2, 'ç”µè„‘': 0.3, 'æ°´æœ': 0.05, 'å¤©æ°”': 0.1, 'æœˆäº®': 0.3, 'æ˜Ÿæ˜Ÿ': 0.3, 'æ±½è½¦': 0.1, 'é£æœº': 0.1, 'æ ‘æœ¨': 0.1, 'èŠ±æœµ': 0.2, 'å»ºç­‘': 0.2, 'é‡‘å±': 0.1
    },
    'å®¶åº­': {
      // ç›¸å…³è¯è¯­ (é«˜ç›¸ä¼¼æ€§)
      'çˆ¶æ¯': 0.9, 'å­©å­': 0.9, 'å…„å¼Ÿ': 0.85, 'å§å¦¹': 0.85, 'äº²æƒ…': 0.95, 'å®¶äºº': 0.95, 'æ¸©æš–': 0.8, 'å›¢èš': 0.85,
      'çˆ±å¿ƒ': 0.8, 'ç…§é¡¾': 0.8, 'é™ªä¼´': 0.8, 'å…³æ€€': 0.8, 'å®ˆæŠ¤': 0.75, 'ä¼ æ‰¿': 0.7, 'è¡€ç¼˜': 0.85, 'äº²äºº': 0.9, 'å®¶æ—': 0.85, 'å’Œç¦': 0.8,
      // æ— å…³è¯è¯­ (ä½ç›¸ä¼¼æ€§)
      'çŸ³å¤´': 0.05, 'æ¤…å­': 0.2, 'æ•°å­—': 0.1, 'é¢œè‰²': 0.1, 'å£°éŸ³': 0.15, 'æ—¶é—´': 0.4, 'ç©ºé—´': 0.3, 'æ–¹å‘': 0.05,
      'æœºå™¨': 0.1, 'ç”µè„‘': 0.15, 'æ°´æœ': 0.2, 'å¤©æ°”': 0.2, 'æœˆäº®': 0.2, 'æ˜Ÿæ˜Ÿ': 0.2, 'æ±½è½¦': 0.3, 'é£æœº': 0.1, 'æ ‘æœ¨': 0.2, 'èŠ±æœµ': 0.3, 'å»ºç­‘': 0.6, 'é‡‘å±': 0.1
    },
    'ç§‘æŠ€': {
      // ç›¸å…³è¯è¯­ (é«˜ç›¸ä¼¼æ€§)
      'ç”µè„‘': 0.9, 'æ‰‹æœº': 0.9, 'äº’è”ç½‘': 0.85, 'äººå·¥æ™ºèƒ½': 0.9, 'ç¼–ç¨‹': 0.85, 'æ•°æ®': 0.8, 'åˆ›æ–°': 0.8, 'å‘æ˜': 0.8,
      'è½¯ä»¶': 0.85, 'ç¡¬ä»¶': 0.85, 'ç½‘ç»œ': 0.8, 'ç®—æ³•': 0.8, 'èŠ¯ç‰‡': 0.85, 'åº”ç”¨': 0.75, 'æ•°å­—': 0.7, 'æ™ºèƒ½': 0.85, 'æŠ€æœ¯': 0.95, 'ç§‘å­¦': 0.8,
      // æ— å…³è¯è¯­ (ä½ç›¸ä¼¼æ€§)
      'çŸ³å¤´': 0.05, 'æ¤…å­': 0.1, 'é¢œè‰²': 0.1, 'å£°éŸ³': 0.2, 'æ—¶é—´': 0.2, 'ç©ºé—´': 0.2, 'æ–¹å‘': 0.1,
      'æ°´æœ': 0.05, 'å¤©æ°”': 0.1, 'æœˆäº®': 0.1, 'æ˜Ÿæ˜Ÿ': 0.15, 'æ±½è½¦': 0.4, 'é£æœº': 0.4, 'æ ‘æœ¨': 0.05, 'èŠ±æœµ': 0.05, 'å»ºç­‘': 0.3, 'é‡‘å±': 0.3
    },
    'æ—…è¡Œ': {
      // ç›¸å…³è¯è¯­ (é«˜ç›¸ä¼¼æ€§)
      'å‡ºæ¸¸': 0.95, 'é£æ™¯': 0.85, 'æ¢ç´¢': 0.8, 'å†’é™©': 0.8, 'æ™¯ç‚¹': 0.9, 'æ—…æ¸¸': 0.95, 'åº¦å‡': 0.85, 'èƒŒåŒ…': 0.8,
      'é…’åº—': 0.8, 'æœºç¥¨': 0.85, 'æŠ¤ç…§': 0.85, 'æ–‡åŒ–': 0.7, 'ä½“éªŒ': 0.8, 'æ”¾æ¾': 0.75, 'æ‹ç…§': 0.8, 'çºªå¿µ': 0.75, 'æ—…ç¨‹': 0.9, 'è¿œæ–¹': 0.8,
      // æ— å…³è¯è¯­ (ä½ç›¸ä¼¼æ€§)
      'çŸ³å¤´': 0.1, 'æ¤…å­': 0.1, 'æ•°å­—': 0.1, 'é¢œè‰²': 0.3, 'å£°éŸ³': 0.2, 'æ—¶é—´': 0.4, 'ç©ºé—´': 0.5, 'æ–¹å‘': 0.6,
      'æœºå™¨': 0.1, 'ç”µè„‘': 0.2, 'æ°´æœ': 0.2, 'å¤©æ°”': 0.4, 'æœˆäº®': 0.3, 'æ˜Ÿæ˜Ÿ': 0.3, 'æ±½è½¦': 0.6, 'é£æœº': 0.8, 'æ ‘æœ¨': 0.4, 'èŠ±æœµ': 0.3, 'å»ºç­‘': 0.5, 'é‡‘å±': 0.1
    },
    'ç¾é£Ÿ': {
      // ç›¸å…³è¯è¯­ (é«˜ç›¸ä¼¼æ€§)
      'æ–™ç†': 0.9, 'çƒ¹é¥ª': 0.9, 'é£Ÿæ': 0.85, 'å‘³é“': 0.9, 'é¤å…': 0.8, 'å¨å¸ˆ': 0.85, 'èœè°±': 0.8, 'é¦™å‘³': 0.85,
      'è¥å…»': 0.75, 'å“å°': 0.9, 'é£Ÿè°±': 0.8, 'ä½³è‚´': 0.9, 'ç¾å‘³': 0.95, 'å£æ„Ÿ': 0.9, 'çƒ¹è°ƒ': 0.85, 'é¥®é£Ÿ': 0.85, 'é£Ÿç‰©': 0.9, 'äº«å—': 0.8,
      // æ— å…³è¯è¯­ (ä½ç›¸ä¼¼æ€§)
      'çŸ³å¤´': 0.05, 'æ¤…å­': 0.15, 'æ•°å­—': 0.05, 'é¢œè‰²': 0.3, 'å£°éŸ³': 0.2, 'æ—¶é—´': 0.2, 'ç©ºé—´': 0.1, 'æ–¹å‘': 0.05,
      'æœºå™¨': 0.2, 'ç”µè„‘': 0.1, 'æ°´æœ': 0.6, 'å¤©æ°”': 0.1, 'æœˆäº®': 0.05, 'æ˜Ÿæ˜Ÿ': 0.05, 'æ±½è½¦': 0.05, 'é£æœº': 0.05, 'æ ‘æœ¨': 0.2, 'èŠ±æœµ': 0.2, 'å»ºç­‘': 0.3, 'é‡‘å±': 0.15
    },
    'é˜…è¯»': {
      // ç›¸å…³è¯è¯­ (é«˜ç›¸ä¼¼æ€§)
      'ä¹¦ç±': 0.95, 'æ–‡å­—': 0.9, 'çŸ¥è¯†': 0.85, 'æ•…äº‹': 0.85, 'ä½œè€…': 0.8, 'å°è¯´': 0.85, 'æ–‡å­¦': 0.85, 'æ€è€ƒ': 0.8,
      'æ™ºæ…§': 0.8, 'å­¦ä¹ ': 0.85, 'ç†è§£': 0.8, 'æƒ³è±¡': 0.75, 'å¯å‘': 0.8, 'æ„Ÿæ‚Ÿ': 0.75, 'ä¹¦é¡µ': 0.9, 'å›¾ä¹¦': 0.9, 'æ–‡ç« ': 0.85, 'ç»å…¸': 0.8,
      // æ— å…³è¯è¯­ (ä½ç›¸ä¼¼æ€§)
      'çŸ³å¤´': 0.05, 'æ¤…å­': 0.2, 'æ•°å­—': 0.3, 'é¢œè‰²': 0.1, 'å£°éŸ³': 0.1, 'æ—¶é—´': 0.4, 'ç©ºé—´': 0.2, 'æ–¹å‘': 0.05,
      'æœºå™¨': 0.1, 'ç”µè„‘': 0.4, 'æ°´æœ': 0.05, 'å¤©æ°”': 0.1, 'æœˆäº®': 0.2, 'æ˜Ÿæ˜Ÿ': 0.2, 'æ±½è½¦': 0.05, 'é£æœº': 0.05, 'æ ‘æœ¨': 0.1, 'èŠ±æœµ': 0.1, 'å»ºç­‘': 0.2, 'é‡‘å±': 0.05
    },
    'æµ·æ´‹': {
      // ç›¸å…³è¯è¯­ (é«˜ç›¸ä¼¼æ€§)
      'å¤§æµ·': 0.95, 'æ³¢æµª': 0.9, 'æµ·æ°´': 0.95, 'æµ·å²¸': 0.85, 'æ²™æ»©': 0.8, 'é±¼ç±»': 0.8, 'æµ·è±š': 0.85, 'çŠç‘š': 0.8,
      'æ½®æ±': 0.85, 'æ·±è“': 0.8, 'æµ·é£': 0.8, 'æµ·é¸Ÿ': 0.75, 'èˆ¹åª': 0.75, 'èˆªæµ·': 0.8, 'æµ·åº•': 0.85, 'è´å£³': 0.8, 'æµ·è—»': 0.8, 'æµªèŠ±': 0.85,
      // æ— å…³è¯è¯­ (ä½ç›¸ä¼¼æ€§)
      'çŸ³å¤´': 0.2, 'æ¤…å­': 0.05, 'æ•°å­—': 0.05, 'é¢œè‰²': 0.4, 'å£°éŸ³': 0.3, 'æ—¶é—´': 0.2, 'ç©ºé—´': 0.4, 'æ–¹å‘': 0.3,
      'æœºå™¨': 0.05, 'ç”µè„‘': 0.05, 'æ°´æœ': 0.1, 'å¤©æ°”': 0.4, 'æœˆäº®': 0.4, 'æ˜Ÿæ˜Ÿ': 0.4, 'æ±½è½¦': 0.05, 'é£æœº': 0.1, 'æ ‘æœ¨': 0.1, 'èŠ±æœµ': 0.2, 'å»ºç­‘': 0.1, 'é‡‘å±': 0.1
    },
    'æ£®æ—': {
      // ç›¸å…³è¯è¯­ (é«˜ç›¸ä¼¼æ€§)
      'æ ‘æœ¨': 0.95, 'ç»¿å¶': 0.9, 'å°é¸Ÿ': 0.85, 'åŠ¨ç‰©': 0.85, 'ç©ºæ°”': 0.8, 'é˜³å…‰': 0.75, 'éœ²æ°´': 0.8, 'æ ‘æ—': 0.95,
      'é‡èŠ±': 0.85, 'è˜‘è‡': 0.8, 'æ¾æœ': 0.8, 'æºªæµ': 0.8, 'æ¸…æ–°': 0.85, 'è‡ªç„¶': 0.9, 'å¾’æ­¥': 0.75, 'é‡è¥': 0.8, 'ç”Ÿæ€': 0.85, 'æ°§æ°”': 0.8,
      // æ— å…³è¯è¯­ (ä½ç›¸ä¼¼æ€§)
      'çŸ³å¤´': 0.3, 'æ¤…å­': 0.05, 'æ•°å­—': 0.05, 'é¢œè‰²': 0.4, 'å£°éŸ³': 0.4, 'æ—¶é—´': 0.2, 'ç©ºé—´': 0.4, 'æ–¹å‘': 0.3,
      'æœºå™¨': 0.05, 'ç”µè„‘': 0.05, 'æ°´æœ': 0.3, 'å¤©æ°”': 0.5, 'æœˆäº®': 0.3, 'æ˜Ÿæ˜Ÿ': 0.3, 'æ±½è½¦': 0.05, 'é£æœº': 0.05, 'èŠ±æœµ': 0.7, 'å»ºç­‘': 0.1, 'é‡‘å±': 0.05
    },
    'åŸå¸‚': {
      // ç›¸å…³è¯è¯­ (é«˜ç›¸ä¼¼æ€§)
      'é«˜æ¥¼': 0.9, 'è¡—é“': 0.9, 'äº¤é€š': 0.85, 'äººç¾¤': 0.85, 'ç¹å': 0.85, 'å•†åº—': 0.8, 'åœ°é“': 0.8, 'å…¬å›­': 0.7,
      'å¹¿åœº': 0.8, 'éœ“è™¹': 0.8, 'å»ºç­‘': 0.9, 'å¸‚æ°‘': 0.85, 'ç”Ÿæ´»': 0.8, 'æ–‡åŒ–': 0.7, 'ç°ä»£': 0.8, 'éƒ½å¸‚': 0.95, 'è½¦è¾†': 0.8, 'ç¤¾åŒº': 0.8,
      // æ— å…³è¯è¯­ (ä½ç›¸ä¼¼æ€§)
      'çŸ³å¤´': 0.2, 'æ¤…å­': 0.1, 'æ•°å­—': 0.2, 'é¢œè‰²': 0.3, 'å£°éŸ³': 0.4, 'æ—¶é—´': 0.3, 'ç©ºé—´': 0.4, 'æ–¹å‘': 0.4,
      'æœºå™¨': 0.3, 'ç”µè„‘': 0.3, 'æ°´æœ': 0.1, 'å¤©æ°”': 0.2, 'æœˆäº®': 0.2, 'æ˜Ÿæ˜Ÿ': 0.2, 'æ±½è½¦': 0.7, 'é£æœº': 0.3, 'æ ‘æœ¨': 0.3, 'èŠ±æœµ': 0.2, 'é‡‘å±': 0.4
    },
    'æ—¶é—´': {
      // ç›¸å…³è¯è¯­ (é«˜ç›¸ä¼¼æ€§)
      'é’Ÿè¡¨': 0.85, 'å²æœˆ': 0.9, 'å†å²': 0.8, 'æœªæ¥': 0.85, 'è¿‡å»': 0.85, 'ç°åœ¨': 0.85, 'ç§’é’Ÿ': 0.9, 'åˆ†é’Ÿ': 0.9,
      'å°æ—¶': 0.85, 'æ—¥å­': 0.8, 'å¹´å': 0.85, 'æ°¸æ’': 0.8, 'ç¬é—´': 0.8, 'æµé€': 0.85, 'è®°å¿†': 0.75, 'å˜åŒ–': 0.75, 'èŠ‚å¥': 0.7, 'æ—¶å…‰': 0.9,
      // æ— å…³è¯è¯­ (ä½ç›¸ä¼¼æ€§)
      'çŸ³å¤´': 0.1, 'æ¤…å­': 0.1, 'æ•°å­—': 0.4, 'é¢œè‰²': 0.1, 'å£°éŸ³': 0.2, 'ç©ºé—´': 0.3, 'æ–¹å‘': 0.2,
      'æœºå™¨': 0.2, 'ç”µè„‘': 0.3, 'æ°´æœ': 0.05, 'å¤©æ°”': 0.3, 'æœˆäº®': 0.3, 'æ˜Ÿæ˜Ÿ': 0.3, 'æ±½è½¦': 0.2, 'é£æœº': 0.2, 'æ ‘æœ¨': 0.2, 'èŠ±æœµ': 0.1, 'å»ºç­‘': 0.2, 'é‡‘å±': 0.1
    },
    'æ¢¦æƒ³': {
      // ç›¸å…³è¯è¯­ (é«˜ç›¸ä¼¼æ€§)
      'ç†æƒ³': 0.95, 'å¸Œæœ›': 0.9, 'ç›®æ ‡': 0.85, 'è¿½æ±‚': 0.9, 'å¥‹æ–—': 0.85, 'æˆåŠŸ': 0.8, 'å®ç°': 0.85, 'æ„¿æœ›': 0.9,
      'æŠ±è´Ÿ': 0.85, 'å¿—å‘': 0.85, 'åŠªåŠ›': 0.8, 'åšæŒ': 0.8, 'ä¿¡å¿µ': 0.8, 'æœªæ¥': 0.8, 'æ¿€æƒ…': 0.8, 'å‹‡æ°”': 0.75, 'åˆ›é€ ': 0.75, 'è¶…è¶Š': 0.8,
      // æ— å…³è¯è¯­ (ä½ç›¸ä¼¼æ€§)
      'çŸ³å¤´': 0.05, 'æ¤…å­': 0.05, 'æ•°å­—': 0.1, 'é¢œè‰²': 0.2, 'å£°éŸ³': 0.2, 'æ—¶é—´': 0.4, 'ç©ºé—´': 0.3, 'æ–¹å‘': 0.3,
      'æœºå™¨': 0.1, 'ç”µè„‘': 0.1, 'æ°´æœ': 0.05, 'å¤©æ°”': 0.2, 'æœˆäº®': 0.4, 'æ˜Ÿæ˜Ÿ': 0.5, 'æ±½è½¦': 0.1, 'é£æœº': 0.2, 'æ ‘æœ¨': 0.1, 'èŠ±æœµ': 0.3, 'å»ºç­‘': 0.2, 'é‡‘å±': 0.05
    },
    'å‹è°Š': {
      // ç›¸å…³è¯è¯­ (é«˜ç›¸ä¼¼æ€§)
      'æœ‹å‹': 0.95, 'ä¼™ä¼´': 0.9, 'ä¿¡ä»»': 0.85, 'åˆ†äº«': 0.8, 'é™ªä¼´': 0.85, 'æ”¯æŒ': 0.8, 'ç†è§£': 0.8, 'å…³å¿ƒ': 0.85,
      'çœŸè¯š': 0.85, 'å¿ è¯š': 0.8, 'äº’åŠ©': 0.8, 'æ¸©æš–': 0.75, 'çè´µ': 0.8, 'æ°¸æ’': 0.75, 'å›å¿†': 0.75, 'é»˜å¥‘': 0.8, 'æƒ…è°Š': 0.9, 'çº¯çœŸ': 0.8,
      // æ— å…³è¯è¯­ (ä½ç›¸ä¼¼æ€§)
      'çŸ³å¤´': 0.05, 'æ¤…å­': 0.05, 'æ•°å­—': 0.05, 'é¢œè‰²': 0.2, 'å£°éŸ³': 0.3, 'æ—¶é—´': 0.4, 'ç©ºé—´': 0.2, 'æ–¹å‘': 0.05,
      'æœºå™¨': 0.05, 'ç”µè„‘': 0.1, 'æ°´æœ': 0.1, 'å¤©æ°”': 0.1, 'æœˆäº®': 0.2, 'æ˜Ÿæ˜Ÿ': 0.2, 'æ±½è½¦': 0.05, 'é£æœº': 0.05, 'æ ‘æœ¨': 0.1, 'èŠ±æœµ': 0.3, 'å»ºç­‘': 0.1, 'é‡‘å±': 0.05
    },
    'æ˜¥å¤©': {
      // ç›¸å…³è¯è¯­ (é«˜ç›¸ä¼¼æ€§)
      'èŠ±æœµ': 0.9, 'ç»¿èŠ½': 0.9, 'æ¸©æš–': 0.8, 'ç”Ÿæœº': 0.85, 'æ¨±èŠ±': 0.85, 'æ˜¥é›¨': 0.85, 'é¸Ÿé¸£': 0.8, 'å¤è‹': 0.85,
      'æ¸…é¦™': 0.8, 'æŸ³çµ®': 0.8, 'é˜³å…‰': 0.8, 'è¸é’': 0.85, 'æ’­ç§': 0.8, 'å¸Œæœ›': 0.75, 'ä¸‡ç‰©': 0.8, 'ç”Ÿé•¿': 0.85, 'æ¡ƒèŠ±': 0.85, 'æ˜¥é£': 0.85,
      // æ— å…³è¯è¯­ (ä½ç›¸ä¼¼æ€§)
      'çŸ³å¤´': 0.1, 'æ¤…å­': 0.05, 'æ•°å­—': 0.05, 'é¢œè‰²': 0.4, 'å£°éŸ³': 0.3, 'æ—¶é—´': 0.3, 'ç©ºé—´': 0.2, 'æ–¹å‘': 0.1,
      'æœºå™¨': 0.05, 'ç”µè„‘': 0.05, 'æ°´æœ': 0.3, 'å¤©æ°”': 0.6, 'æœˆäº®': 0.2, 'æ˜Ÿæ˜Ÿ': 0.2, 'æ±½è½¦': 0.05, 'é£æœº': 0.05, 'æ ‘æœ¨': 0.7, 'å»ºç­‘': 0.1, 'é‡‘å±': 0.05
    },
    'å·¥ä½œ': {
      // ç›¸å…³è¯è¯­ (é«˜ç›¸ä¼¼æ€§)
      'èŒä¸š': 0.9, 'äº‹ä¸š': 0.85, 'åŒäº‹': 0.8, 'åŠå…¬': 0.85, 'ä¼šè®®': 0.8, 'é¡¹ç›®': 0.8, 'è´£ä»»': 0.75, 'åŠªåŠ›': 0.8,
      'æˆå°±': 0.8, 'å›¢é˜Ÿ': 0.8, 'ä»»åŠ¡': 0.85, 'ç›®æ ‡': 0.8, 'ä¸“ä¸š': 0.8, 'æŠ€èƒ½': 0.75, 'æ•ˆç‡': 0.75, 'åˆä½œ': 0.8, 'æŒ‘æˆ˜': 0.75, 'å‘å±•': 0.8,
      // æ— å…³è¯è¯­ (ä½ç›¸ä¼¼æ€§)
      'çŸ³å¤´': 0.05, 'æ¤…å­': 0.2, 'æ•°å­—': 0.3, 'é¢œè‰²': 0.1, 'å£°éŸ³': 0.2, 'æ—¶é—´': 0.5, 'ç©ºé—´': 0.3, 'æ–¹å‘': 0.2,
      'æœºå™¨': 0.3, 'ç”µè„‘': 0.6, 'æ°´æœ': 0.05, 'å¤©æ°”': 0.1, 'æœˆäº®': 0.05, 'æ˜Ÿæ˜Ÿ': 0.05, 'æ±½è½¦': 0.2, 'é£æœº': 0.1, 'æ ‘æœ¨': 0.05, 'èŠ±æœµ': 0.1, 'å»ºç­‘': 0.4, 'é‡‘å±': 0.2
    },
    'çˆ±æƒ…': {
      // ç›¸å…³è¯è¯­ (é«˜ç›¸ä¼¼æ€§)
      'æ‹äºº': 0.9, 'æµªæ¼«': 0.9, 'å¿ƒåŠ¨': 0.85, 'æ¸©æŸ”': 0.8, 'ç”œèœœ': 0.85, 'ä¾æ‹': 0.8, 'ç›¸ä¼´': 0.8, 'å…³æ€€': 0.8,
      'æ·±æƒ…': 0.85, 'ç‰µæ‰‹': 0.85, 'æ‹¥æŠ±': 0.8, 'çº¦ä¼š': 0.8, 'æ€å¿µ': 0.8, 'æ‰¿è¯º': 0.8, 'æ°¸æ’': 0.75, 'çœŸå¿ƒ': 0.85, 'æƒ…è¯': 0.8, 'å¹¸ç¦': 0.8,
      // æ— å…³è¯è¯­ (ä½ç›¸ä¼¼æ€§)
      'çŸ³å¤´': 0.05, 'æ¤…å­': 0.05, 'æ•°å­—': 0.05, 'é¢œè‰²': 0.3, 'å£°éŸ³': 0.3, 'æ—¶é—´': 0.4, 'ç©ºé—´': 0.2, 'æ–¹å‘': 0.05,
      'æœºå™¨': 0.05, 'ç”µè„‘': 0.05, 'æ°´æœ': 0.2, 'å¤©æ°”': 0.2, 'æœˆäº®': 0.6, 'æ˜Ÿæ˜Ÿ': 0.6, 'æ±½è½¦': 0.1, 'é£æœº': 0.1, 'æ ‘æœ¨': 0.2, 'èŠ±æœµ': 0.7, 'å»ºç­‘': 0.1, 'é‡‘å±': 0.05
    },
    'åˆ›é€ ': {
      // ç›¸å…³è¯è¯­ (é«˜ç›¸ä¼¼æ€§)
      'å‘æ˜': 0.9, 'æƒ³è±¡': 0.85, 'è‰ºæœ¯': 0.85, 'è®¾è®¡': 0.85, 'çµæ„Ÿ': 0.9, 'åŸåˆ›': 0.9, 'åˆ›æ–°': 0.95, 'æ„æ€': 0.85,
      'è¡¨è¾¾': 0.8, 'ä½œå“': 0.85, 'ç¾æ„Ÿ': 0.8, 'ç‹¬ç‰¹': 0.8, 'æ‰å': 0.8, 'çªç ´': 0.8, 'å®ç°': 0.75, 'åˆ›æ„': 0.95, 'åˆ¶ä½œ': 0.8, 'è¯ç”Ÿ': 0.8,
      // æ— å…³è¯è¯­ (ä½ç›¸ä¼¼æ€§)
      'çŸ³å¤´': 0.1, 'æ¤…å­': 0.1, 'æ•°å­—': 0.2, 'é¢œè‰²': 0.4, 'å£°éŸ³': 0.3, 'æ—¶é—´': 0.3, 'ç©ºé—´': 0.3, 'æ–¹å‘': 0.1,
      'æœºå™¨': 0.3, 'ç”µè„‘': 0.4, 'æ°´æœ': 0.05, 'å¤©æ°”': 0.1, 'æœˆäº®': 0.2, 'æ˜Ÿæ˜Ÿ': 0.2, 'æ±½è½¦': 0.2, 'é£æœº': 0.2, 'æ ‘æœ¨': 0.2, 'èŠ±æœµ': 0.4, 'å»ºç­‘': 0.5, 'é‡‘å±': 0.2
    },
    'å‹‡æ°”': {
      // ç›¸å…³è¯è¯­ (é«˜ç›¸ä¼¼æ€§)
      'åšå¼º': 0.9, 'æ— ç•': 0.95, 'å‹‡æ•¢': 0.95, 'èƒ†é‡': 0.9, 'æŒ‘æˆ˜': 0.85, 'é¢å¯¹': 0.8, 'å…‹æœ': 0.85, 'åšæŒ': 0.8,
      'å†³å¿ƒ': 0.85, 'æ„å¿—': 0.85, 'è‹±é›„': 0.8, 'å†’é™©': 0.85, 'çªç ´': 0.8, 'è‡ªä¿¡': 0.8, 'åŠ›é‡': 0.85, 'å¾æœ': 0.8, 'å¥‹æ–—': 0.8, 'è¶…è¶Š': 0.8,
      // æ— å…³è¯è¯­ (ä½ç›¸ä¼¼æ€§)
      'çŸ³å¤´': 0.1, 'æ¤…å­': 0.05, 'æ•°å­—': 0.05, 'é¢œè‰²': 0.1, 'å£°éŸ³': 0.2, 'æ—¶é—´': 0.3, 'ç©ºé—´': 0.3, 'æ–¹å‘': 0.3,
      'æœºå™¨': 0.1, 'ç”µè„‘': 0.1, 'æ°´æœ': 0.05, 'å¤©æ°”': 0.2, 'æœˆäº®': 0.2, 'æ˜Ÿæ˜Ÿ': 0.3, 'æ±½è½¦': 0.2, 'é£æœº': 0.3, 'æ ‘æœ¨': 0.1, 'èŠ±æœµ': 0.1, 'å»ºç­‘': 0.2, 'é‡‘å±': 0.1
    },
    'å°ç‹—': {
      // ç›¸å…³è¯è¯­ (é«˜ç›¸ä¼¼æ€§)
      'æœ‰æ¯›': 0.9, 'ä¼šå«': 0.95, 'æ˜¯å® ç‰©': 0.95, 'å¿ è¯š': 0.85, 'å¯çˆ±': 0.9, 'æ´»æ³¼': 0.85, 'é™ªä¼´': 0.8, 'æ‘‡å°¾å·´': 0.9,
      'æ•£æ­¥': 0.8, 'ç©è€': 0.85, 'å®ˆæŠ¤': 0.8, 'æ¸©é¡º': 0.85, 'æœºçµ': 0.8, 'å¬è¯': 0.85, 'äº²äºº': 0.8, 'æ¯›èŒ¸èŒ¸': 0.9, 'æ±ªæ±ª': 0.95, 'å°åŠ¨ç‰©': 0.8,
      // æ— å…³è¯è¯­ (ä½ç›¸ä¼¼æ€§)
      'çŸ³å¤´': 0.05, 'æ¤…å­': 0.1, 'æ•°å­—': 0.05, 'é¢œè‰²': 0.2, 'å£°éŸ³': 0.4, 'æ—¶é—´': 0.1, 'ç©ºé—´': 0.1, 'æ–¹å‘': 0.05,
      'æœºå™¨': 0.05, 'ç”µè„‘': 0.05, 'æ°´æœ': 0.1, 'å¤©æ°”': 0.2, 'æœˆäº®': 0.1, 'æ˜Ÿæ˜Ÿ': 0.1, 'æ±½è½¦': 0.1, 'é£æœº': 0.05, 'æ ‘æœ¨': 0.2, 'èŠ±æœµ': 0.2, 'å»ºç­‘': 0.1, 'é‡‘å±': 0.05
    },
    'å­™æ‚Ÿç©º': {
      // ç›¸å…³è¯è¯­ (é«˜ç›¸ä¼¼æ€§)
      'ä¼šå˜èº«': 0.95, 'æœ‰é‡‘ç®æ£’': 0.95, 'æ‰“å¦–æ€ª': 0.9, 'é½å¤©å¤§åœ£': 0.95, 'ç«çœ¼é‡‘ç›': 0.9, 'ç­‹æ–—äº‘': 0.9, 'ä¸ƒåäºŒå˜': 0.95, 'èŠ±æœå±±': 0.85,
      'ç¾çŒ´ç‹': 0.9, 'å¤§é—¹å¤©å®«': 0.9, 'ä¿æŠ¤å”åƒ§': 0.85, 'é™å¦–é™¤é­”': 0.9, 'ç¥é€šå¹¿å¤§': 0.9, 'æœºæ™ºå‹‡æ•¢': 0.85, 'çŸ³çŒ´': 0.8, 'å–è¥¿ç»': 0.8, 'æ–—æˆ˜èƒœä½›': 0.85, 'æœ¬é¢†é«˜å¼º': 0.85,
      // æ— å…³è¯è¯­ (ä½ç›¸ä¼¼æ€§)
      'çŸ³å¤´': 0.2, 'æ¤…å­': 0.05, 'æ•°å­—': 0.05, 'é¢œè‰²': 0.1, 'å£°éŸ³': 0.2, 'æ—¶é—´': 0.3, 'ç©ºé—´': 0.4, 'æ–¹å‘': 0.2,
      'æœºå™¨': 0.1, 'ç”µè„‘': 0.05, 'æ°´æœ': 0.3, 'å¤©æ°”': 0.2, 'æœˆäº®': 0.3, 'æ˜Ÿæ˜Ÿ': 0.3, 'æ±½è½¦': 0.05, 'é£æœº': 0.2, 'æ ‘æœ¨': 0.3, 'èŠ±æœµ': 0.2, 'å»ºç­‘': 0.2, 'é‡‘å±': 0.1
    },
    'çŒªå…«æˆ’': {
      // ç›¸å…³è¯è¯­ (é«˜ç›¸ä¼¼æ€§)
      'å–Šæ•£ä¼™': 0.9, 'èƒŒåª³å¦‡': 0.9, 'ä¹é½¿é’‰è€™': 0.95, 'å¤©è“¬å…ƒå¸…': 0.9, 'å¥½åƒæ‡’åš': 0.85, 'è´ªè´¢å¥½è‰²': 0.8, 'æ†¨åšè€å®': 0.85, 'é«˜è€åº„': 0.85,
      'å«¦å¨¥ä»™å­': 0.75, 'æŠ•èƒè½¬ä¸–': 0.8, 'å–è¥¿ç»': 0.8, 'äºŒå¸ˆå…„': 0.9, 'å‡€å›ä½¿è€…': 0.85, 'æç¬‘å¹½é»˜': 0.85, 'æ€•å›°éš¾': 0.8, 'çˆ±æŠ±æ€¨': 0.8, 'å–„è‰¯æœ¬æ€§': 0.75, 'å¿ å¿ƒè€¿è€¿': 0.8,
      // æ— å…³è¯è¯­ (ä½ç›¸ä¼¼æ€§)
      'çŸ³å¤´': 0.05, 'æ¤…å­': 0.1, 'æ•°å­—': 0.05, 'é¢œè‰²': 0.1, 'å£°éŸ³': 0.2, 'æ—¶é—´': 0.2, 'ç©ºé—´': 0.2, 'æ–¹å‘': 0.1,
      'æœºå™¨': 0.05, 'ç”µè„‘': 0.05, 'æ°´æœ': 0.4, 'å¤©æ°”': 0.2, 'æœˆäº®': 0.4, 'æ˜Ÿæ˜Ÿ': 0.3, 'æ±½è½¦': 0.05, 'é£æœº': 0.05, 'æ ‘æœ¨': 0.2, 'èŠ±æœµ': 0.2, 'å»ºç­‘': 0.1, 'é‡‘å±': 0.05
    },
    'æ›¹æ“': {
      // ç›¸å…³è¯è¯­ (é«˜ç›¸ä¼¼æ€§)
      'æ”¿æ²»å®¶': 0.95, 'æœ‰é›„å¿ƒ': 0.9, 'æ‰“å¤©ä¸‹': 0.9, 'é­æ­¦å¸': 0.95, 'æŒŸå¤©å­': 0.85, 'ä»¤è¯¸ä¾¯': 0.85, 'ç»Ÿä¸€åŒ—æ–¹': 0.85, 'æ–‡éŸ¬æ­¦ç•¥': 0.9,
      'æ±‚è´¤è‹¥æ¸´': 0.8, 'å¥¸é›„': 0.8, 'æ­é›„': 0.85, 'è¯—äºº': 0.7, 'å†›äº‹å®¶': 0.9, 'é‡å¿ƒå‹ƒå‹ƒ': 0.85, 'æƒè°‹': 0.85, 'ä¹±ä¸–è‹±é›„': 0.85, 'ä¸‰å›½éœ¸ä¸»': 0.9, 'æ²»ä¸–èƒ½è‡£': 0.8,
      // æ— å…³è¯è¯­ (ä½ç›¸ä¼¼æ€§)
      'çŸ³å¤´': 0.05, 'æ¤…å­': 0.1, 'æ•°å­—': 0.1, 'é¢œè‰²': 0.1, 'å£°éŸ³': 0.1, 'æ—¶é—´': 0.4, 'ç©ºé—´': 0.2, 'æ–¹å‘': 0.2,
      'æœºå™¨': 0.1, 'ç”µè„‘': 0.05, 'æ°´æœ': 0.05, 'å¤©æ°”': 0.1, 'æœˆäº®': 0.1, 'æ˜Ÿæ˜Ÿ': 0.1, 'æ±½è½¦': 0.05, 'é£æœº': 0.05, 'æ ‘æœ¨': 0.05, 'èŠ±æœµ': 0.05, 'å»ºç­‘': 0.3, 'é‡‘å±': 0.2
    },
    'åˆ˜å¤‡': {
      // ç›¸å…³è¯è¯­ (é«˜ç›¸ä¼¼æ€§)
      'åˆ˜çš‡å”': 0.95, 'ä»å¾·å®½åš': 0.95, 'åŒè‚¡å‰‘': 0.9, 'èœ€æ±‰çš‡å¸': 0.95, 'æ¡ƒå›­ç»“ä¹‰': 0.9, 'ä¸‰é¡¾èŒ…åº': 0.85, 'ä»ä¹‰ä¹‹å›': 0.9, 'çˆ±æ°‘å¦‚å­': 0.9,
      'ç¤¼è´¤ä¸‹å£«': 0.85, 'ç™½å¸æ‰˜å­¤': 0.8, 'å¤å…´æ±‰å®¤': 0.85, 'ä»è€…æ— æ•Œ': 0.85, 'å®½å®¹å¤§åº¦': 0.85, 'çŸ¥äººå–„ä»»': 0.8, 'ä»æ…ˆå–„è‰¯': 0.9, 'çš‡å®¤è¡€ç»Ÿ': 0.8, 'ä»å›å…¸èŒƒ': 0.85, 'çˆ±å“­é¼»å­': 0.7,
      // æ— å…³è¯è¯­ (ä½ç›¸ä¼¼æ€§)
      'çŸ³å¤´': 0.05, 'æ¤…å­': 0.1, 'æ•°å­—': 0.05, 'é¢œè‰²': 0.1, 'å£°éŸ³': 0.1, 'æ—¶é—´': 0.4, 'ç©ºé—´': 0.2, 'æ–¹å‘': 0.1,
      'æœºå™¨': 0.05, 'ç”µè„‘': 0.05, 'æ°´æœ': 0.05, 'å¤©æ°”': 0.1, 'æœˆäº®': 0.1, 'æ˜Ÿæ˜Ÿ': 0.1, 'æ±½è½¦': 0.05, 'é£æœº': 0.05, 'æ ‘æœ¨': 0.1, 'èŠ±æœµ': 0.2, 'å»ºç­‘': 0.2, 'é‡‘å±': 0.1
    },
    'æ—é»›ç‰': {
      // ç›¸å…³è¯è¯­ (é«˜ç›¸ä¼¼æ€§)
      'çˆ±å†™è¯—': 0.95, 'ä½å¤§è§‚å›­': 0.9, 'å¤šæ„å–„æ„Ÿ': 0.95, 'ç»›ç ä»™å­': 0.9, 'è¿˜æ³ªä¹‹è¯´': 0.85, 'æ‰åæ¨ªæº¢': 0.9, 'ä½“å¼±å¤šç—…': 0.8, 'æ¸…é«˜å­¤å‚²': 0.85,
      'å°–é…¸åˆ»è–„': 0.7, 'æ•æ„Ÿèªæ…§': 0.9, 'è¯—æƒ…ç”»æ„': 0.9, 'çº¢é¢œè–„å‘½': 0.8, 'è‘¬èŠ±è¯': 0.9, 'æ½‡æ¹˜å¦ƒå­': 0.85, 'çœ¼æ³ªå¦‚ç ': 0.85, 'å†°é›ªèªæ˜': 0.85, 'å­¤èŠ³è‡ªèµ': 0.8, 'å‡„ç¾åŠ¨äºº': 0.85,
      // æ— å…³è¯è¯­ (ä½ç›¸ä¼¼æ€§)
      'çŸ³å¤´': 0.1, 'æ¤…å­': 0.1, 'æ•°å­—': 0.05, 'é¢œè‰²': 0.3, 'å£°éŸ³': 0.2, 'æ—¶é—´': 0.4, 'ç©ºé—´': 0.2, 'æ–¹å‘': 0.05,
      'æœºå™¨': 0.05, 'ç”µè„‘': 0.05, 'æ°´æœ': 0.2, 'å¤©æ°”': 0.3, 'æœˆäº®': 0.5, 'æ˜Ÿæ˜Ÿ': 0.4, 'æ±½è½¦': 0.05, 'é£æœº': 0.05, 'æ ‘æœ¨': 0.3, 'èŠ±æœµ': 0.7, 'å»ºç­‘': 0.4, 'é‡‘å±': 0.05
    },
    'è´¾å®ç‰': {
      // ç›¸å…³è¯è¯­ (é«˜ç›¸ä¼¼æ€§)
      'è£å›½åºœå…¬å­': 0.95, 'åŒå¼ƒç§‘ä¸¾': 0.9, 'é€šçµå®ç‰': 0.95, 'æ€¡çº¢å…¬å­': 0.9, 'è´¾åºœå«¡å­™': 0.9, 'å›é€†å…¬å­': 0.85, 'æƒ…ç—´æƒ…ç§': 0.9, 'å¥³å„¿å›½é‡Œ': 0.85,
      'å¯Œè´µé—²äºº': 0.8, 'æ¸©æ–‡å°”é›…': 0.85, 'å¤šæƒ…å–„æ„Ÿ': 0.9, 'ä¸åŠ¡æ­£ä¸š': 0.8, 'è¯—ä¹¦ä¼ å®¶': 0.8, 'çº¢æ¥¼æ¢¦ä¸»': 0.95, 'é£æµå€œå‚¥': 0.85, 'çº¨ç»”å­å¼Ÿ': 0.8, 'ç—´æƒ…ç§å­': 0.9, 'è´µæ—å…¬å­': 0.85,
      // æ— å…³è¯è¯­ (ä½ç›¸ä¼¼æ€§)
      'çŸ³å¤´': 0.2, 'æ¤…å­': 0.1, 'æ•°å­—': 0.05, 'é¢œè‰²': 0.3, 'å£°éŸ³': 0.2, 'æ—¶é—´': 0.3, 'ç©ºé—´': 0.2, 'æ–¹å‘': 0.05,
      'æœºå™¨': 0.05, 'ç”µè„‘': 0.05, 'æ°´æœ': 0.2, 'å¤©æ°”': 0.2, 'æœˆäº®': 0.4, 'æ˜Ÿæ˜Ÿ': 0.4, 'æ±½è½¦': 0.05, 'é£æœº': 0.05, 'æ ‘æœ¨': 0.2, 'èŠ±æœµ': 0.6, 'å»ºç­‘': 0.5, 'é‡‘å±': 0.1
    },
    'æ­¦æ¾': {
      // ç›¸å…³è¯è¯­ (é«˜ç›¸ä¼¼æ€§)
      'æ‰“è™': 0.95, 'æ¢å±±å¥½æ±‰': 0.9, 'æ‰“æŠ±ä¸å¹³': 0.95, 'è¡Œè€…æ­¦æ¾': 0.95, 'æ™¯é˜³å†ˆ': 0.9, 'é†‰æ‰“è’‹é—¨ç¥': 0.85, 'è¡€æº…é¸³é¸¯æ¥¼': 0.85, 'éƒ½å¤´': 0.8,
      'è‹±é›„å¥½æ±‰': 0.9, 'æ­¦è‰ºé«˜å¼º': 0.9, 'å«‰æ¶å¦‚ä»‡': 0.9, 'ä¹‰è–„äº‘å¤©': 0.85, 'è±ªä¾ ä»—ä¹‰': 0.85, 'åˆšæ­£ä¸é˜¿': 0.85, 'é™¤æš´å®‰è‰¯': 0.9, 'å¿«æ„æ©ä»‡': 0.85, 'ä¾ è‚ä¹‰èƒ†': 0.85, 'å¨éœ‡å¤©ä¸‹': 0.8,
      // æ— å…³è¯è¯­ (ä½ç›¸ä¼¼æ€§)
      'çŸ³å¤´': 0.1, 'æ¤…å­': 0.05, 'æ•°å­—': 0.05, 'é¢œè‰²': 0.1, 'å£°éŸ³': 0.2, 'æ—¶é—´': 0.2, 'ç©ºé—´': 0.3, 'æ–¹å‘': 0.2,
      'æœºå™¨': 0.05, 'ç”µè„‘': 0.05, 'æ°´æœ': 0.1, 'å¤©æ°”': 0.2, 'æœˆäº®': 0.1, 'æ˜Ÿæ˜Ÿ': 0.1, 'æ±½è½¦': 0.1, 'é£æœº': 0.05, 'æ ‘æœ¨': 0.2, 'èŠ±æœµ': 0.1, 'å»ºç­‘': 0.2, 'é‡‘å±': 0.2
    },
    'æé€µ': {
      // ç›¸å…³è¯è¯­ (é«˜ç›¸ä¼¼æ€§)
      'é»‘æ—‹é£': 0.95, 'åŒæ¿æ–§': 0.95, 'å¤´è„‘ç®€å•': 0.9, 'æ¢å±±å¥½æ±‰': 0.9, 'æ²‚å²­æ€å››è™': 0.85, 'çœŸå‡æé€µ': 0.8, 'ä¸ºæ¯æ€è™': 0.85, 'å¿ ä¹‰åŒå…¨': 0.85,
      'æ€§æ ¼ç‡ç›´': 0.9, 'ç²—ä¸­æœ‰ç»†': 0.8, 'å­é¡ºæ¯äº²': 0.85, 'ä¹‰æ°”æ·±é‡': 0.85, 'å‹‡çŒ›æ— æ•Œ': 0.85, 'å¤©çœŸçƒ‚æ¼«': 0.8, 'å•çº¯ç›´ç‡': 0.85, 'å«‰æ¶å¦‚ä»‡': 0.85, 'èµ¤èƒ†å¿ å¿ƒ': 0.85, 'è½æ’å†²åŠ¨': 0.8,
      // æ— å…³è¯è¯­ (ä½ç›¸ä¼¼æ€§)
      'çŸ³å¤´': 0.1, 'æ¤…å­': 0.05, 'æ•°å­—': 0.05, 'é¢œè‰²': 0.1, 'å£°éŸ³': 0.3, 'æ—¶é—´': 0.2, 'ç©ºé—´': 0.2, 'æ–¹å‘': 0.2,
      'æœºå™¨': 0.05, 'ç”µè„‘': 0.05, 'æ°´æœ': 0.1, 'å¤©æ°”': 0.2, 'æœˆäº®': 0.1, 'æ˜Ÿæ˜Ÿ': 0.1, 'æ±½è½¦': 0.1, 'é£æœº': 0.05, 'æ ‘æœ¨': 0.3, 'èŠ±æœµ': 0.1, 'å»ºç­‘': 0.1, 'é‡‘å±': 0.3
    }
  };

  // åˆ›å»ºåŸºäºè¯è¯­çš„ä¼ªéšæœºæ•°ç”Ÿæˆå™¨
  const getSeededRandom = (seed: string, index: number = 0): number => {
    let hash = 0;
    const fullSeed = seed + index.toString();
    for (let i = 0; i < fullSeed.length; i++) {
      const char = fullSeed.charCodeAt(i);
      hash = ((hash << 5) - hash) + char;
      hash = hash & hash; // è½¬æ¢ä¸º32ä½æ•´æ•°
    }
    // å°†hashè½¬æ¢ä¸º0-1ä¹‹é—´çš„æ•°
    return Math.abs(hash % 10000) / 10000;
  };

  const generateWordPositions = (): WordPosition[] => {
    if (!centerWord || selectedWords.length === 0) return [];

    const positions: WordPosition[] = [];
    const centerSimilarities = similarityData[centerWord] || {};

    // æŒ‰ç›¸ä¼¼åº¦åˆ†ç»„
    const relatedWords = selectedWords.filter(word => (centerSimilarities[word] || 0) >= 0.6);
    const unrelatedWords = selectedWords.filter(word => (centerSimilarities[word] || 0) < 0.6);

    // å¤„ç†ç›¸å…³è¯è¯­ - èšå›¢æ˜¾ç¤º
    relatedWords.forEach((word, index) => {
      const similarity = centerSimilarities[word] || 0;
      
      // ç›¸å…³è¯è¯­è·ç¦»ä¸­å¿ƒè¾ƒè¿‘ï¼Œå½¢æˆèšå›¢
      const baseDistance = 1.5 + (1 - similarity) * 1.5; // è·ç¦»èŒƒå›´ 1.5-3
      
      // ä½¿ç”¨è¯è¯­åç§°ä½œä¸ºç§å­ï¼Œç¡®ä¿ä½ç½®å›ºå®š
      const clusterAngle = (index / relatedWords.length) * Math.PI * 2;
      const randomOffset1 = getSeededRandom(word, 1);
      const randomOffset2 = getSeededRandom(word, 2);
      const randomOffset3 = getSeededRandom(word, 3);
      
      const clusterRadius = 0.8 + randomOffset1 * 0.4; // èšå›¢å†…çš„å›ºå®šåˆ†å¸ƒ
      
      const x = baseDistance * Math.cos(clusterAngle) + clusterRadius * (randomOffset2 - 0.5);
      const y = baseDistance * Math.sin(clusterAngle) + clusterRadius * (randomOffset3 - 0.5);
      const z = (getSeededRandom(word, 4) - 0.5) * 1.5; // Zè½´ä¸Šçš„å°å¹…å˜åŒ–

      positions.push({
        word,
        x, y, z,
        similarity,
        isRelated: true
      });
    });

    // å¤„ç†æ— å…³è¯è¯­ - åˆ†æ•£æ˜¾ç¤º
    unrelatedWords.forEach((word, index) => {
      const similarity = centerSimilarities[word] || 0;
      
      // æ— å…³è¯è¯­è·ç¦»ä¸­å¿ƒè¾ƒè¿œï¼Œåˆ†æ•£åˆ†å¸ƒ
      const distance = 4 + getSeededRandom(word, 5) * 2; // è·ç¦»èŒƒå›´ 4-6
      
      // åœ¨å¤–å›´çƒé¢ä¸Šå›ºå®šåˆ†å¸ƒ
      const angle1 = getSeededRandom(word, 6) * Math.PI * 2;
      const angle2 = Math.acos(1 - 2 * getSeededRandom(word, 7));
      
      const x = distance * Math.sin(angle2) * Math.cos(angle1);
      const y = distance * Math.sin(angle2) * Math.sin(angle1);
      const z = distance * Math.cos(angle2);

      positions.push({
        word,
        x, y, z,
        similarity,
        isRelated: false
      });
    });

    return positions;
  };

  const wordPositions = generateWordPositions();

  // åŠ¨ç”»å¾ªç¯
  useEffect(() => {
    const startTime = Date.now();
    
    const animate = () => {
      const currentTime = Date.now();
      const time = (currentTime - startTime) * 0.001; // è½¬æ¢ä¸ºç§’
      setAnimationTime(time);
      
      // è‡ªåŠ¨æ—‹è½¬
      if (autoRotate && !isDragging) {
        setRotation(prev => ({
          x: prev.x + 0.003, // Xè½´ç¼“æ…¢æ—‹è½¬
          y: prev.y + 0.005  // Yè½´ç¨å¿«æ—‹è½¬
        }));
      }
      
      animationFrameRef.current = requestAnimationFrame(animate);
    };
    
    animate();
    
    return () => {
      if (animationFrameRef.current) {
        cancelAnimationFrame(animationFrameRef.current);
      }
    };
  }, [autoRotate, isDragging]);

  // è¯è¯­å‡ºç°åŠ¨ç”»
  useEffect(() => {
    if (selectedWords.length > 0) {
      setWordsAppearProgress(0);
      const duration = 1500; // 1.5ç§’
      const startTime = Date.now();
      
      const animateAppear = () => {
        const elapsed = Date.now() - startTime;
        const progress = Math.min(elapsed / duration, 1);
        setWordsAppearProgress(progress);
        
        if (progress < 1) {
          requestAnimationFrame(animateAppear);
        }
      };
      
      animateAppear();
    }
  }, [selectedWords.length]);

  // åˆå§‹åŒ–æ˜Ÿç©ºèƒŒæ™¯
  useEffect(() => {
    const canvas = canvasRef.current;
    if (!canvas) return;
    
    const newStars = [];
    for (let i = 0; i < 150; i++) {
      newStars.push({
        x: Math.random() * canvas.width,
        y: Math.random() * canvas.height,
        size: Math.random() * 2 + 0.5,
        opacity: Math.random() * 0.8 + 0.2,
        twinkleSpeed: Math.random() * 0.02 + 0.01
      });
    }
    setStars(newStars);
  }, []);

  // 3Dç‚¹æŠ•å½±åˆ°2Då±å¹•åæ ‡
  const project3DTo2D = (x: number, y: number, z: number) => {
    const canvas = canvasRef.current;
    if (!canvas) return { x: 0, y: 0, scale: 1 };

    const centerX = canvas.width / 2;
    const centerY = canvas.height / 2;
    const fov = 300;

    // åº”ç”¨æ—‹è½¬
    const cosX = Math.cos(rotation.x);
    const sinX = Math.sin(rotation.x);
    const cosY = Math.cos(rotation.y);
    const sinY = Math.sin(rotation.y);

    // ç»•Yè½´æ—‹è½¬
    const x1 = x * cosY - z * sinY;
    const z1 = x * sinY + z * cosY;
    
    // ç»•Xè½´æ—‹è½¬
    const y2 = y * cosX - z1 * sinX;
    const z2 = y * sinX + z1 * cosX;

    // é€è§†æŠ•å½±
    const scale = fov / (fov + z2);
    // åœ¨æœ€ç»ˆå±å¹•åæ ‡è®¡ç®—æ—¶åº”ç”¨ç¼©æ”¾
    const screenX = centerX + x1 * scale * 50 * zoom;
    const screenY = centerY + y2 * scale * 50 * zoom;

    return { x: screenX, y: screenY, scale };
  };

  useEffect(() => {
    const canvas = canvasRef.current;
    if (!canvas) return;

    const ctx = canvas.getContext('2d');
    if (!ctx) return;

    const draw = () => {
      // æ¸…ç©ºç”»å¸ƒ
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // ç»˜åˆ¶æ˜Ÿç©ºèƒŒæ™¯
      drawStarryBackground(ctx);

      // ç»˜åˆ¶èƒŒæ™¯ç½‘æ ¼ï¼ˆå¸¦åŠ¨ç”»ï¼‰
      drawAnimatedGrid(ctx);

      // ç»˜åˆ¶åæ ‡è½´ï¼ˆå¸¦åŠ¨ç”»ï¼‰
      drawAnimatedAxes(ctx);

      // ç»˜åˆ¶ä¸­å¿ƒè¯
      if (centerWord) {
        const centerPos = project3DTo2D(0, 0, 0);
        const pulseScale = 1 + Math.sin(animationTime * 2) * 0.1; // è„‰åŠ¨æ•ˆæœ
        drawWord(ctx, centerWord, centerPos.x, centerPos.y, centerPos.scale * pulseScale, true, centerWord === hoveredWord);
      }

      // ç»˜åˆ¶å…¶ä»–è¯è¯­ï¼ˆå¸¦å‡ºç°åŠ¨ç”»ï¼‰
      wordPositions.forEach((wordPos, index) => {
        const appearDelay = (index / wordPositions.length) * 0.5; // é”™å¼€å‡ºç°æ—¶é—´
        const appearProgress = Math.max(0, Math.min(1, (wordsAppearProgress - appearDelay) / 0.5));
        
        if (appearProgress > 0) {
          // è®¡ç®—åŠ¨ç”»ä½ç½®ï¼ˆä»ä¸­å¿ƒé£å‡ºï¼‰
          const animatedX = wordPos.x * appearProgress;
          const animatedY = wordPos.y * appearProgress;
          const animatedZ = wordPos.z * appearProgress;
          
          const pos = project3DTo2D(animatedX, animatedY, animatedZ);
          
          // è¿æ¥çº¿å·²ç§»é™¤ï¼Œä½¿ç”¨é¢œè‰²å’Œä½ç½®èšç±»æ¥è¡¨ç¤ºå…³è”åº¦
          
          // ç»˜åˆ¶è¯è¯­ï¼ˆå¸¦ç¼©æ”¾åŠ¨ç”»ï¼‰
          const scaleAnimation = appearProgress * (1 + Math.sin(animationTime * 3 + index) * 0.05);
          drawWord(ctx, wordPos.word, pos.x, pos.y, pos.scale * scaleAnimation, false, wordPos.word === hoveredWord, wordPos.isRelated, wordPos.similarity, appearProgress);
        }
      });

      // ç»˜åˆ¶è¯´æ˜
      drawLegend(ctx);
    };

    const drawStarryBackground = (ctx: CanvasRenderingContext2D) => {
      // åˆ›å»ºæ·±è‰²æ˜Ÿç©ºæ¸å˜èƒŒæ™¯
      const gradient = ctx.createRadialGradient(
        canvas.width / 2, canvas.height / 2, 0,
        canvas.width / 2, canvas.height / 2, canvas.width / 2
      );
      gradient.addColorStop(0, '#0a1225');
      gradient.addColorStop(0.6, '#16213e');
      gradient.addColorStop(1, '#0f172a');
      
      ctx.fillStyle = gradient;
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      
      // ç»˜åˆ¶æ˜Ÿæ˜Ÿ
      stars.forEach((star, index) => {
        const twinkle = Math.sin(animationTime * star.twinkleSpeed + index) * 0.3 + 0.7;
        const alpha = star.opacity * twinkle;
        
        // æ˜Ÿæ˜Ÿå…‰æ™•æ•ˆæœ
        const glowSize = star.size * 3;
        const glowGradient = ctx.createRadialGradient(star.x, star.y, 0, star.x, star.y, glowSize);
        glowGradient.addColorStop(0, `rgba(255, 255, 255, ${alpha * 0.8})`);
        glowGradient.addColorStop(0.5, `rgba(200, 220, 255, ${alpha * 0.3})`);
        glowGradient.addColorStop(1, 'rgba(200, 220, 255, 0)');
        
        ctx.fillStyle = glowGradient;
        ctx.beginPath();
        ctx.arc(star.x, star.y, glowSize, 0, Math.PI * 2);
        ctx.fill();
        
        // æ˜Ÿæ˜Ÿä¸»ä½“
        ctx.fillStyle = `rgba(255, 255, 255, ${alpha})`;
        ctx.beginPath();
        ctx.arc(star.x, star.y, star.size, 0, Math.PI * 2);
        ctx.fill();
      });
    };

    const drawAnimatedGrid = (ctx: CanvasRenderingContext2D) => {
      const opacity = 0.15 + Math.sin(animationTime * 0.8) * 0.05; // æ›´æŸ”å’Œçš„é€æ˜åº¦åŠ¨ç”»
      
      // ç»˜åˆ¶å¤šå±‚ç½‘æ ¼ï¼Œåˆ›é€ 3Dæ·±åº¦æ„Ÿ
      const layers = [
        { z: 0, opacity: opacity * 1.2, color: '#9ca3af' },
        { z: -2, opacity: opacity * 0.6, color: '#6b7280' },
        { z: 2, opacity: opacity * 0.6, color: '#6b7280' }
      ];
      
      layers.forEach(layer => {
        ctx.strokeStyle = layer.color;
        ctx.lineWidth = layer.z === 0 ? 1.5 : 0.8;
        ctx.globalAlpha = layer.opacity;
        
        for (let i = -4; i <= 4; i++) {
          if (i === 0) continue;
          
          // Xæ–¹å‘ç½‘æ ¼çº¿
          const start1 = project3DTo2D(i, -4, layer.z);
          const end1 = project3DTo2D(i, 4, layer.z);
          ctx.beginPath();
          ctx.moveTo(start1.x, start1.y);
          ctx.lineTo(end1.x, end1.y);
          ctx.stroke();
          
          // Yæ–¹å‘ç½‘æ ¼çº¿
          const start2 = project3DTo2D(-4, i, layer.z);
          const end2 = project3DTo2D(4, i, layer.z);
          ctx.beginPath();
          ctx.moveTo(start2.x, start2.y);
          ctx.lineTo(end2.x, end2.y);
          ctx.stroke();
        }
      });
      
      // ç»˜åˆ¶ç½‘æ ¼äº¤ç‚¹
      ctx.globalAlpha = opacity * 0.8;
      for (let x = -4; x <= 4; x += 2) {
        for (let y = -4; y <= 4; y += 2) {
          if (x === 0 && y === 0) continue;
          const point = project3DTo2D(x, y, 0);
          ctx.fillStyle = '#9ca3af';
          ctx.beginPath();
          ctx.arc(point.x, point.y, 1.5, 0, Math.PI * 2);
          ctx.fill();
        }
      }
      
      ctx.globalAlpha = 1;
    };

    const drawAnimatedAxes = (ctx: CanvasRenderingContext2D) => {
      const axisLength = 6;
      const pulseIntensity = 1 + Math.sin(animationTime * 1.2) * 0.15;
      
      // ç»˜åˆ¶åŸç‚¹
      const origin = project3DTo2D(0, 0, 0);
      ctx.fillStyle = '#d1d5db';
      ctx.shadowColor = '#d1d5db';
      ctx.shadowBlur = 8;
      ctx.beginPath();
      ctx.arc(origin.x, origin.y, 5, 0, Math.PI * 2);
      ctx.fill();
      ctx.shadowBlur = 0;
      
      // Xè½´ (ç°è‰²) - è¯­ä¹‰ç»´åº¦1
      drawStylizedAxis(ctx, -axisLength, 0, 0, axisLength, 0, 0, '#9ca3af', 'X', 'è¯­ä¹‰ç»´åº¦1', pulseIntensity);
      
      // Yè½´ (ç°è‰²) - è¯­ä¹‰ç»´åº¦2  
      drawStylizedAxis(ctx, 0, -axisLength, 0, 0, axisLength, 0, '#9ca3af', 'Y', 'è¯­ä¹‰ç»´åº¦2', pulseIntensity);
      
      // Zè½´ (ç°è‰²) - è¯­ä¹‰ç»´åº¦3
      drawStylizedAxis(ctx, 0, 0, -axisLength, 0, 0, axisLength, '#9ca3af', 'Z', 'è¯­ä¹‰ç»´åº¦3', pulseIntensity);
    };

    const drawStylizedAxis = (ctx: CanvasRenderingContext2D, x1: number, y1: number, z1: number, x2: number, y2: number, z2: number, color: string, label: string, description: string, pulse: number) => {
      const start = project3DTo2D(x1, y1, z1);
      const end = project3DTo2D(x2, y2, z2);
      
      // ä¸»è½´çº¿ - æ¸å˜æ•ˆæœ
      const gradient = ctx.createLinearGradient(start.x, start.y, end.x, end.y);
      gradient.addColorStop(0, `${color}40`);
      gradient.addColorStop(0.5, color);
      gradient.addColorStop(1, `${color}40`);
      
      ctx.strokeStyle = gradient;
      ctx.lineWidth = 3 + pulse * 0.5;
      ctx.shadowColor = color;
      ctx.shadowBlur = 8 + pulse * 4;
      
      ctx.beginPath();
      ctx.moveTo(start.x, start.y);
      ctx.lineTo(end.x, end.y);
      ctx.stroke();
      ctx.shadowBlur = 0;
      
      // ç»˜åˆ¶ç®­å¤´
      drawArrowHead(ctx, start, end, color, pulse);
      
      // ç»˜åˆ¶è½´æ ‡ç­¾
      drawAxisLabel(ctx, end, label, description, color);
      
      // ç»˜åˆ¶åˆ»åº¦
      drawAxisTicks(ctx, x1, y1, z1, x2, y2, z2, color);
    };

    const drawArrowHead = (ctx: CanvasRenderingContext2D, start: any, end: any, color: string, pulse: number) => {
      const angle = Math.atan2(end.y - start.y, end.x - start.x);
      const arrowLength = 15 + pulse * 3;
      const arrowAngle = Math.PI / 6;
      
      ctx.fillStyle = color;
      ctx.shadowColor = color;
      ctx.shadowBlur = 6;
      
      ctx.beginPath();
      ctx.moveTo(end.x, end.y);
      ctx.lineTo(
        end.x - arrowLength * Math.cos(angle - arrowAngle),
        end.y - arrowLength * Math.sin(angle - arrowAngle)
      );
      ctx.lineTo(
        end.x - arrowLength * Math.cos(angle + arrowAngle),
        end.y - arrowLength * Math.sin(angle + arrowAngle)
      );
      ctx.closePath();
      ctx.fill();
      ctx.shadowBlur = 0;
    };

    const drawAxisLabel = (ctx: CanvasRenderingContext2D, pos: any, label: string, description: string, color: string) => {
      // ä¸»æ ‡ç­¾
      ctx.fillStyle = color;
      ctx.font = 'bold 16px Arial';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.shadowColor = color;
      ctx.shadowBlur = 3;
      ctx.fillText(label, pos.x + 20, pos.y - 20);
      ctx.shadowBlur = 0;
      
      // æè¿°æ–‡å­—
      ctx.fillStyle = '#64748b';
      ctx.font = '11px Arial';
      ctx.fillText(description, pos.x + 20, pos.y - 5);
    };

    const drawAxisTicks = (ctx: CanvasRenderingContext2D, x1: number, y1: number, z1: number, x2: number, y2: number, z2: number, color: string) => {
      const steps = 5;
      ctx.strokeStyle = `${color}80`;
      ctx.lineWidth = 1;
      
      for (let i = 1; i < steps; i++) {
        const t = i / steps;
        const tickX = x1 + (x2 - x1) * t;
        const tickY = y1 + (y2 - y1) * t;
        const tickZ = z1 + (z2 - z1) * t;
        
        const tickPos = project3DTo2D(tickX, tickY, tickZ);
        
        // ç»˜åˆ¶åˆ»åº¦çº¿
        ctx.beginPath();
        ctx.arc(tickPos.x, tickPos.y, 2, 0, Math.PI * 2);
        ctx.stroke();
        
        // åˆ»åº¦æ•°å­—
        ctx.fillStyle = '#6b7280';
        ctx.font = '10px Arial';
        ctx.textAlign = 'center';
        ctx.fillText(i.toString(), tickPos.x + 8, tickPos.y - 8);
      }
    };

    const drawConnection = (ctx: CanvasRenderingContext2D, start: any, end: any, similarity: number, alpha: number = 1) => {
      const color = similarity > 0.5 ? '#10b981' : '#ef4444';
      const animatedWidth = Math.max(1, similarity * 3) + Math.sin(animationTime * 2) * 0.5;
      
      ctx.strokeStyle = color;
      ctx.lineWidth = animatedWidth;
      ctx.globalAlpha = 0.6 * alpha;
      ctx.shadowColor = color;
      ctx.shadowBlur = 3;
      
      ctx.beginPath();
      ctx.moveTo(start.x, start.y);
      ctx.lineTo(end.x, end.y);
      ctx.stroke();
      
      ctx.shadowBlur = 0;
      ctx.globalAlpha = 1;
    };

    // æ ¹æ®ç›¸ä¼¼åº¦è·å–å½©è™¹è‰²
    const getSimilarityColor = (similarity: number): { r: number, g: number, b: number } => {
      // å°†ç›¸ä¼¼åº¦æ˜ å°„åˆ°å½©è™¹è‰²è°± (0-1 å¯¹åº”çº¢åˆ°ç´«)
      const hue = similarity * 300; // 0-300åº¦ï¼Œçº¢è‰²åˆ°ç´«è‰²
      const saturation = 0.8;
      const lightness = 0.6;
      
      // HSLè½¬RGB
      const c = (1 - Math.abs(2 * lightness - 1)) * saturation;
      const x = c * (1 - Math.abs((hue / 60) % 2 - 1));
      const m = lightness - c / 2;
      
      let r, g, b;
      if (hue < 60) {
        r = c; g = x; b = 0;
      } else if (hue < 120) {
        r = x; g = c; b = 0;
      } else if (hue < 180) {
        r = 0; g = c; b = x;
      } else if (hue < 240) {
        r = 0; g = x; b = c;
      } else if (hue < 300) {
        r = x; g = 0; b = c;
      } else {
        r = c; g = 0; b = x;
      }
      
      return {
        r: Math.round((r + m) * 255),
        g: Math.round((g + m) * 255),
        b: Math.round((b + m) * 255)
      };
    };

    const drawWord = (ctx: CanvasRenderingContext2D, word: string, x: number, y: number, scale: number, isCenter: boolean, isHovered: boolean, isRelated?: boolean, similarity?: number, alpha: number = 1) => {
      const baseSize = Math.max(8, 12 * scale);
      const hoverMultiplier = isHovered ? 1.2 : 1;
      const breatheEffect = isCenter ? (1 + Math.sin(animationTime * 3) * 0.1) : 1;
      const size = baseSize * hoverMultiplier * breatheEffect;
      
      const radius = size + 4;
      
      if (isCenter) {
        // ä¸­å¿ƒè¯ç‰¹æ®Šæ ·å¼ - é‡‘è‰²å…‰ç¯æ•ˆæœ
        const glowRadius = radius + Math.sin(animationTime * 2) * 3;
        
        // å¤–å±‚å…‰ç¯
        ctx.fillStyle = `rgba(251, 191, 36, ${0.3 * alpha})`;
        ctx.beginPath();
        ctx.arc(x, y, glowRadius, 0, Math.PI * 2);
        ctx.fill();
        
        // ä¸»ä½“åœ†åœˆ
        ctx.fillStyle = isHovered ? `rgba(245, 158, 11, ${alpha})` : `rgba(251, 191, 36, ${alpha})`;
        ctx.shadowColor = '#fbbf24';
        ctx.shadowBlur = 10;
      } else {
        // æ ¹æ®ç›¸ä¼¼åº¦ä½¿ç”¨å½©è™¹è‰²
        const sim = similarity || 0;
        const color = getSimilarityColor(sim);
        const pulse = 1 + Math.sin(animationTime * 4 + x + y) * 0.05;
        
        const baseColor = `rgba(${color.r}, ${color.g}, ${color.b}, ${alpha})`;
        const hoverColor = `rgba(${Math.max(0, color.r - 30)}, ${Math.max(0, color.g - 30)}, ${Math.max(0, color.b - 30)}, ${alpha})`;
        
        ctx.fillStyle = isHovered ? hoverColor : baseColor;
        ctx.shadowColor = `rgb(${color.r}, ${color.g}, ${color.b})`;
        ctx.shadowBlur = 5 + (sim * 5) * pulse;
      }
      
      // ç»˜åˆ¶è¯è¯­èƒŒæ™¯åœ†åœˆ
      ctx.beginPath();
      ctx.arc(x, y, radius, 0, Math.PI * 2);
      ctx.fill();
      ctx.shadowBlur = 0;
      
      // ç»˜åˆ¶è¯è¯­æ–‡å­—
      ctx.fillStyle = 'white';
      ctx.font = `bold ${size}px Arial`;
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.shadowColor = 'rgba(0,0,0,0.5)';
      ctx.shadowBlur = 1;
      ctx.fillText(word, x, y);
      ctx.shadowBlur = 0;
      
      // å¦‚æœæœ‰ç›¸ä¼¼æ€§ä¿¡æ¯ï¼Œæ˜¾ç¤ºæ•°å€¼
      if (similarity !== undefined && !isCenter) {
        ctx.fillStyle = `rgba(55, 65, 81, ${alpha})`;
        ctx.font = `${Math.max(8, 10 * scale)}px Arial`;
        ctx.fillText((similarity * 100).toFixed(0) + '%', x, y + size + 15);
      }
    };

    const drawLegend = (ctx: CanvasRenderingContext2D) => {
      const legendX = 30;
      const legendY = canvas.height - 150;
      const legendWidth = 200;
      const legendHeight = 135;
      
      // èƒŒæ™¯ - é€æ˜æ•ˆæœ
      ctx.fillStyle = 'rgba(0, 0, 0, 0.3)';
      ctx.shadowColor = 'rgba(0, 0, 0, 0.2)';
      ctx.shadowBlur = 10;
      ctx.shadowOffsetY = 3;
      
      // ä½¿ç”¨roundRectç»˜åˆ¶åœ†è§’çŸ©å½¢
      ctx.beginPath();
      const radius = 12;
      ctx.moveTo(legendX - 15 + radius, legendY - 15);
      ctx.lineTo(legendX - 15 + legendWidth - radius, legendY - 15);
      ctx.quadraticCurveTo(legendX - 15 + legendWidth, legendY - 15, legendX - 15 + legendWidth, legendY - 15 + radius);
      ctx.lineTo(legendX - 15 + legendWidth, legendY - 15 + legendHeight - radius);
      ctx.quadraticCurveTo(legendX - 15 + legendWidth, legendY - 15 + legendHeight, legendX - 15 + legendWidth - radius, legendY - 15 + legendHeight);
      ctx.lineTo(legendX - 15 + radius, legendY - 15 + legendHeight);
      ctx.quadraticCurveTo(legendX - 15, legendY - 15 + legendHeight, legendX - 15, legendY - 15 + legendHeight - radius);
      ctx.lineTo(legendX - 15, legendY - 15 + radius);
      ctx.quadraticCurveTo(legendX - 15, legendY - 15, legendX - 15 + radius, legendY - 15);
      ctx.closePath();
      ctx.fill();
      
      ctx.shadowBlur = 0;
      ctx.shadowOffsetY = 0;
      
      // è¾¹æ¡†
      ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
      ctx.lineWidth = 1;
      ctx.stroke();
      
      // æ ‡é¢˜
      ctx.fillStyle = 'white';
      ctx.font = 'bold 14px Arial';
      ctx.textAlign = 'left';
      ctx.fillText('ğŸŒˆ ç›¸ä¼¼åº¦è‰²å½©æ˜ å°„', legendX, legendY + 10);
      
      // ä¸­å¿ƒè¯
      ctx.fillStyle = '#fbbf24';
      ctx.shadowColor = '#fbbf24';
      ctx.shadowBlur = 8;
      ctx.beginPath();
      ctx.arc(legendX + 10, legendY + 35, 6, 0, Math.PI * 2);
      ctx.fill();
      ctx.shadowBlur = 0;
      
      ctx.fillStyle = 'white';
      ctx.font = '12px Arial';
      ctx.fillText('ä¸­å¿ƒè¯ (é‡‘è‰²)', legendX + 25, legendY + 40);
      
      // å½©è™¹è‰²æ¸å˜æ¡
      const gradientY = legendY + 55;
      const gradientWidth = 150;
      const gradientHeight = 8;
      
      // ç»˜åˆ¶æ¸å˜æ¡
      for (let i = 0; i < gradientWidth; i++) {
        const similarity = i / gradientWidth;
        const color = getSimilarityColor(similarity);
        ctx.fillStyle = `rgb(${color.r}, ${color.g}, ${color.b})`;
        ctx.fillRect(legendX + i, gradientY, 1, gradientHeight);
      }
      
      // æ¸å˜æ¡æ ‡ç­¾
      ctx.fillStyle = 'white';
      ctx.font = '10px Arial';
      ctx.textAlign = 'left';
      ctx.fillText('ä½ç›¸ä¼¼åº¦', legendX, gradientY + gradientHeight + 15);
      ctx.textAlign = 'right';
      ctx.fillText('é«˜ç›¸ä¼¼åº¦', legendX + gradientWidth, gradientY + gradientHeight + 15);
      
      // è¯´æ˜æ–‡å­—
      ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
      ctx.font = '11px Arial';
      ctx.textAlign = 'left';
      ctx.fillText('â€¢ ç›¸ä¼¼è¯è¯­èšå›¢æ˜¾ç¤ºï¼Œè·ç¦»è¿‘', legendX, legendY + 90);
      ctx.fillText('â€¢ æ— å…³è¯è¯­åˆ†æ•£æ˜¾ç¤ºï¼Œè·ç¦»è¿œ', legendX, legendY + 105);
    };

    draw();
  }, [centerWord, selectedWords, rotation, zoom, hoveredWord, animationTime, wordsAppearProgress]);

  // æ»šè½®äº‹ä»¶å¤„ç†å‡½æ•° - ä½¿ç”¨Reactäº‹ä»¶å¤„ç†å™¨
  const handleWheel = (e: React.WheelEvent) => {
    e.stopPropagation();
    const delta = e.deltaY > 0 ? 0.9 : 1.1;
    setZoom(prev => Math.max(0.5, Math.min(3, prev * delta)));
  };

  // é¼ æ ‡äº‹ä»¶å¤„ç†
  const handleMouseDown = (e: React.MouseEvent) => {
    setIsDragging(true);
    setAutoRotate(false); // æ‹–æ‹½æ—¶åœæ­¢è‡ªåŠ¨æ—‹è½¬
    setLastMouse({ x: e.clientX, y: e.clientY });
  };

  const handleMouseMove = (e: React.MouseEvent) => {
    if (isDragging) {
      const deltaX = e.clientX - lastMouse.x;
      const deltaY = e.clientY - lastMouse.y;
      
      setRotation(prev => ({
        x: prev.x + deltaY * 0.01,
        y: prev.y + deltaX * 0.01
      }));
      
      setLastMouse({ x: e.clientX, y: e.clientY });
    } else {
      // æ£€æµ‹é¼ æ ‡æ‚¬åœçš„è¯è¯­
      const canvas = canvasRef.current;
      if (!canvas) return;
      
      const rect = canvas.getBoundingClientRect();
      const mouseX = e.clientX - rect.left;
      const mouseY = e.clientY - rect.top;
      
      let hoveredWord = null;
      
      // æ£€æŸ¥ä¸­å¿ƒè¯
      if (centerWord) {
        const centerPos = project3DTo2D(0, 0, 0);
        const distance = Math.sqrt((mouseX - centerPos.x) ** 2 + (mouseY - centerPos.y) ** 2);
        if (distance < 20) hoveredWord = centerWord;
      }
      
      // æ£€æŸ¥å…¶ä»–è¯è¯­
      if (!hoveredWord) {
        for (const wordPos of wordPositions) {
          const pos = project3DTo2D(wordPos.x, wordPos.y, wordPos.z);
          const distance = Math.sqrt((mouseX - pos.x) ** 2 + (mouseY - pos.y) ** 2);
          if (distance < 20) {
            hoveredWord = wordPos.word;
            break;
          }
        }
      }
      
      setHoveredWord(hoveredWord);
    }
  };

  const handleMouseUp = () => {
    setIsDragging(false);
  };

  if (!centerWord) {
    return (
      <div className="space-visualization-3d">
        <div className="empty-3d-state">
          <div className="empty-3d-icon">ğŸŒ</div>
          <h3>3Dè¯è¯­ç©ºé—´</h3>
          <p>é€‰æ‹©ä¸€ä¸ªä¸­å¿ƒè¯å’Œç›¸å…³è¯è¯­ï¼Œå¼€å§‹æ¢ç´¢å®ƒä»¬åœ¨ä¸‰ç»´ç©ºé—´ä¸­çš„ä½ç½®å…³ç³»ï¼</p>
        </div>
      </div>
    );
  }

  return (
    <div className="space-visualization-3d">
      <div className="visualization-3d-header">
        <h2>ğŸŒ 3Dè¯è¯­ç©ºé—´</h2>
        <div className="controls-3d">
          <button 
            className="control-btn"
            onClick={() => {
              setRotation({ x: 0, y: 0 });
              setAutoRotate(true);
            }}
          >
            ğŸ”„ é‡ç½®è§†è§’
          </button>
          <button 
            className="control-btn"
            onClick={() => setAutoRotate(!autoRotate)}
            style={{
              background: autoRotate ? '#10b981' : 'white',
              color: autoRotate ? 'white' : '#475569'
            }}
          >
            {autoRotate ? 'â¸ï¸ æš‚åœæ—‹è½¬' : 'â–¶ï¸ è‡ªåŠ¨æ—‹è½¬'}
          </button>
          <div className="zoom-info">
            ç¼©æ”¾: {(zoom * 100).toFixed(0)}%
          </div>
        </div>
      </div>
      
      <div 
        className="canvas-container"
        onWheel={handleWheel}
        style={{ touchAction: 'none' }}
      >
        <canvas
          ref={canvasRef}
          width={960}
          height={500}
          onMouseDown={handleMouseDown}
          onMouseMove={handleMouseMove}
          onMouseUp={handleMouseUp}
          onMouseLeave={handleMouseUp}
          style={{ cursor: isDragging ? 'grabbing' : 'grab' }}
        />
      </div>
      
      <div className="interaction-hints">
        <p>ğŸ’¡ <strong>æ“ä½œæç¤ºï¼š</strong></p>
        <p>â€¢ æ‹–æ‹½æ—‹è½¬è§†è§’ â€¢ æ»šè½®ç¼©æ”¾ â€¢ æ‚¬åœæŸ¥çœ‹è¯è¯­è¯¦æƒ…</p>
      </div>
    </div>
  );
};

export default SpaceVisualization3D;
